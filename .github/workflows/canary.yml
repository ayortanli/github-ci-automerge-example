name: canary
on:
  push:
    branches:
      - canary
  workflow_run:
    workflows: 
      - main
    types:
      - completed
jobs:  
  build:
    name: Build after checkout 
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Main Branch
      uses: actions/checkout@v2
      with: 
        ref: main
    - name: Checkout Canary and Merge Master to it
      run: |      
        git config user.name github-actions
        git config user.email github-actions@github.com
        git fetch
        git checkout canary
        git merge main
        git commit -m "automerging main to canary"
        git push
    - name: Build
      run: echo 'Building... blah blah...'
    - name: Deploy
      run: echo 'Deploying... blah blah...'